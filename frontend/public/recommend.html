<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>岗位推荐 - 实习直聘</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* 基础布局样式 */
        body {
            margin: 0;
            padding-top: 60px; /* 为固定导航栏留出空间 */
            min-height: 100vh;
            background-color: #f5f5f5;
        }

        /* 主容器样式调整 */
        .main-container {
            width: 100%;
            margin: 0;
            padding: 20px;
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 24px;
            background: white;
            box-sizing: border-box;
        }

        /* 搜索区域样式调整 */
        .search-section {
            width: 100%;
            margin: 0;
            padding: 24px;
            background-color: #f6f8fa;
            border-bottom: 1px solid #d0d7de;
        }

        /* 搜索容器样式 */
        .search-container {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
            padding: 0 20px; /* 添加左右内边距 */
        }

        .main-search-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #f057c2;
            border-radius: 8px;
            font-size: 17px;
            background: white;
        }

        .search-button {
            padding: 12px 24px;
            background-color: #CA4499;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        /* 热门搜索标签样式 */
        .hot-tags {
            max-width: 800px;
            margin: 12px auto 0;
            padding: 0 20px; /* 与搜索框保持相同的左右内边距 */
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .hot-tag {
            color: #57606a;
            text-decoration: none;
            font-size: 14px;
            padding: 4px 12px;
            border-radius: 15px;
            transition: all 0.3s;
            background-color: #f7bbf8;
            color: white;
        }

        .hot-tag:hover {
            color: #0969da;
            background-color: #f0f3f7;
        }

        /* 左侧筛选栏样式调整 */
        .filter-sidebar {
            background: white;
            padding: 5px 20px 20px;  /* 修改上内边距为 5px，保持左右下内边距不变 */
            position: sticky;
            top: 80px;
            height: fit-content;
            border-right: 1px solid #d0d7de;
        }

        .filter-title {
            font-size: 16px;
            color: #24292f;
            font-weight: 600;
            margin: 0 0 16px -8px;  /* 修改上边距为 0，保持其他边距不变 */
            padding: 8px 0;
        }

        .filter-section {
            margin-bottom: 24px;
        }

        .filter-section h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #24292f;
            margin-bottom: 12px;
            padding: 4px 0;
        }

        .filter-section h3 i {
            color: #CA4499;  /* 使用主题色 */
            font-size: 16px;
            width: 20px;  /* 固定宽度使图标对齐 */
        }

        .section-count {
            color: #57606a;
            font-size: 12px;
            font-weight: normal;
        }

        .filter-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .filter-item {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 2px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
        }

        .filter-item:hover {
            background-color: #f3f4f6;
        }

        .filter-item.selected {
            background-color: #e5e7eb;
        }

        .filter-item.selected::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background-color: #2563eb;
        }

        .filter-label {
            color: #24292f;
            font-size: 14px;
            flex-grow: 1;
        }

        .filter-count {
            color: #57606a;
            font-size: 12px;
            background-color: #f0f3f7;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 24px;
            text-align: center;
        }

        /* 移除复选框 */
        .filter-checkbox {
            display: none;
        }

        /* 内容区域调整 */
        .content-area {
            background: white;
            padding: 20px;
        }

        /* 工具栏样式调整 */
        .toolbar {
            display: flex;
            justify-content: space-between;  /* 两端对齐 */
            align-items: center;
            padding: 16px 0;
            margin-bottom: 16px;
            border-bottom: 1px solid #e1e4e8;
        }

        .result-info {
            font-size: 20px;
            color: #24292f;
            font-weight: bold;
        }

        /* 修改排序按钮容器样式 */
        .sort-buttons {
            display: flex;
            gap: 12px;
            margin-right: 20px;  /* 与右侧对齐 */
        }

        .sort-btn {
            padding: 6px 12px;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            background: white;
            color: #57606a;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .sort-btn:hover {
            background: #f6f8fa;
            border-color: #b0b7be;
        }

        .sort-btn.active {
            background: #f6f8fa;
            border-color: #CA4499;
            color: #CA4499;
        }

        .sort-btn i {
            font-size: 16px;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            text-decoration: none;  /* 去掉下划线 */
            padding: 8px 16px;
            border-radius: 6px;
            color: #24292f;
            background: #f6f8fa;
            border: 1px solid #d0d7de;
            margin-right: 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .action-btn:hover {
            background-color: #0969da;
            color: white;
        }

        .action-btn.active {
            background-color: #0969da;
            color: white;
        }

        .action-btn i {
            font-size: 14px;
        }

        .job-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* 职位卡片样式 */
        .job-card {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .job-title {
            font-size: 18px;
            color: #0366d6;
            margin: 0;
            flex: 1;
        }

        .apply-btn {
            background: #2ea44f;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .apply-btn:hover {
            background: #2c974b;
        }

        .job-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            color: #586069;
            font-size: 14px;
        }

        .company-name {
            color: #24292e;
        }

        .salary {
            color: #f85a40;
            font-weight: 500;
        }

        .update-time {
            color: #6a737d;
            font-size: 14px;
        }

        .job-tags {
            display: flex;
            gap: 8px;
        }

        .tag {
            font-size: 12px;
            color: #586069;
            padding: 2px 8px;
            background: #f1f8ff;
            border-radius: 12px;
        }

        /* 分页样式 */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 24px;
        }

        .page-btn {
            padding: 6px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .page-btn:hover {
            background: #f6f8fa;
        }

        .page-btn.active {
            background: #0366d6;
            color: white;
            border-color: #0366d6;
        }

        /* 右侧推广区域调整 */
        .promotion-area {
            background: white;
            padding: 20px;
            position: sticky;
            top: 80px;
            height: fit-content;
        }

        .promotion-box {
            border: 1px solid #d0d7de;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 24px;  /* 增加卡片之间的间距 */
        }

        .promotion-box img {
    width: 50%;          /* 图片宽度占满容器 */
    height: auto;         /* 高度自适应，保持图片比例 */
    object-fit: contain;  /* 保持图片比例，不裁剪 */
    border-radius: 6px;   /* 添加圆角 */
    margin-bottom: 12px;
}

        .promotion-title {
            font-size: 16px;
            font-weight: 600;
            color: #24292f;
            margin-bottom: 8px;
        }

        .promotion-content {
            color: #57606a;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .promotion-link {
            color: #0969da;
            text-decoration: none;
            font-size: 14px;
        }

        .promotion-link:hover {
            text-decoration: underline;
        }

        /* Footer 样式覆盖 */
        .site-footer {
            width: 100%;
            margin: 0;
            padding: 40px 0 20px;
        }

        .footer-content, .footer-bottom {
            width: 100%;
            max-width: none;
            padding: 0 40px;
            box-sizing: border-box;
        }

        /* 响应式布局 */
        @media (max-width: 1400px) {
            .main-container {
                grid-template-columns: 220px 1fr 250px;
            }
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 200px 1fr;
            }
            .promotion-area {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            .filter-sidebar {
                display: none;
            }
        }

        .actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .favorite-btn {
            position: absolute;
            right: 20px;
            bottom: 20px;
            border: none;
            background: none;
            cursor: pointer;
            padding: 8px;
            transition: transform 0.2s;
        }

        .favorite-btn i {
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .favorite-btn:hover {
            transform: scale(1.1);
        }

        .favorite-btn i.far {
            color: #999;
        }

        .favorite-btn i.fas {
            color: #CA4499;
        }

        /* 添加加载状态样式 */
        .favorite-btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        /* 添加反馈提示样式 */
        .feedback-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            z-index: 1000;
            display: none;
        }

        /* 申请弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .apply-modal {
            background-color: white;
            border-radius: 12px;
            width: 450px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            animation: modal-appear 0.3s ease-out;
        }

        @keyframes modal-appear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #f0f0f0;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 18px;
            color: #999;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background-color: #f5f5f5;
            color: #666;
        }

        .modal-body {
            padding: 24px;
        }

        .job-company, .job-salary {
            display: flex;
            align-items: center;
            color: #666;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .job-company i, .job-salary i {
            width: 20px;
            color: #CA4499;
            margin-right: 8px;
        }

        .confirm-message {
            display: flex;
            align-items: center;
            background-color: rgba(202, 68, 153, 0.08);
            padding: 12px 16px;
            border-radius: 8px;
            color: #CA4499;
        }

        .confirm-message i {
            font-size: 18px;
            margin-right: 10px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid #f0f0f0;
            background-color: #fafafa;
        }

        .cancel-btn {
            padding: 10px 20px;
            background-color: white;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cancel-btn:hover {
            border-color: #bbb;
            color: #333;
        }

        .confirm-btn {
            padding: 10px 24px;
            background-color: #CA4499;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .confirm-btn:hover {
            background-color: #b93c89;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(202, 68, 153, 0.3);
        }

        .confirm-btn:active {
            transform: translateY(0);
        }

        .confirm-btn:disabled {
            background-color: #e0e0e0;
            color: #a0a0a0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* 消息提示样式 */
        .message-toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100%);
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .message-toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .message-toast.success {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }

        .message-toast.error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }

        /* 职位详情弹窗样式 */
        .job-detail-modal {
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        /* 1. 顶部标题栏 */
        .job-detail-modal .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fafafa;
        }

        .job-detail-modal .modal-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        .job-detail-modal .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
        }

        /* 2. 主要内容区域 */
        .job-detail-modal .modal-body {
            padding: 24px;
        }

        /* 2.1 职位标题和薪资 */
        .job-detail-modal .job-header-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #f5f5f5;
        }

        .job-detail-modal .job-header-info h2 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }

        .job-detail-modal .job-header-info h2 .title {
            font-size: 22px;
            color: #333;
            font-weight: 600;
        }

        .job-detail-modal .job-header-info h2 .tag {
            font-size: 13px;
            color: #666;
            background-color: rgba(202, 68, 153, 0.08);
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: normal;
        }

        /* 删除重复的样式，只保留一个 .job-detail-modal .salary 的定义 */
        .job-detail-modal .salary {
            color: #333;  /* 黑色文字 */
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .job-detail-modal .salary::before {
            content: '\f157';  /* Font Awesome 的 fa-yen-sign 图标 */
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            font-size: 18px;
            color: #CA4499;  /* 品牌色图标 */
        }

        /* 2.2 公司信息和标签 */
        .job-detail-modal .company-info {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .job-detail-modal .company-name {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .job-detail-modal .company-name::before {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23CA4499"><path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/></svg>') center/contain no-repeat;
        }

        .job-detail-modal .location {
            color: #666;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .job-detail-modal .location::before {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23CA4499"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>') center/contain no-repeat;
        }

        .job-detail-modal .job-tags {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #f5f5f5;
        }

        .job-detail-modal .tag {
            padding: 6px 16px;
            background-color: #f7f7f7;
            border-radius: 4px;
            color: #666;
            font-size: 14px;
        }

        /* 2.3 职位描述和要求 */
        .job-detail-modal .job-description,
        .job-detail-modal .job-requirements {
            margin-bottom: 24px;
        }

        .job-detail-modal .job-description h4,
        .job-detail-modal .job-requirements h4 {
            font-size: 16px;
            color: #333;
            font-weight: 600;
            margin: 0 0 12px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .job-detail-modal .job-description h4::before,
        .job-detail-modal .job-requirements h4::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 16px;
            background-color: #CA4499;
            border-radius: 2px;
        }

        .job-detail-modal .job-description p,
        .job-detail-modal .job-requirements p {
            color: #666;
            line-height: 1.8;
            margin: 0;
            font-size: 14px;
            white-space: pre-line;
            padding-left: 2px;
        }

        /* 3. 底部按钮区域 - 调整间距 */
        .job-detail-modal .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;  /* 减小上下内边距 */
            margin-top: 20px;  /* 增加与内容的间距 */
            border-top: 1px solid #f0f0f0;
            background-color: #fafafa;
        }

        /* 3.1 收藏按钮 */
        .job-detail-modal .modal-footer .favorite-btn {
            position: relative;
            top: -8px;  /* 向上调整 */
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
        }

        /* 3.2 投递简历按钮 */
        .job-detail-modal .modal-footer .apply-btn {
            position: relative;
            top: -8px;  /* 向上调整 */
            padding: 8px 24px;
            background: #CA4499;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        /* 1. 职位标题和薪资区域 */
        .job-detail-modal .job-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .job-detail-modal .job-title h3 {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .job-detail-modal .job-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }

        .job-detail-modal .job-meta span {
            padding: 2px 8px;
            background: rgba(202, 68, 153, 0.1);
            border-radius: 4px;
        }

        /* 2. 薪资和公司信息 */
        .job-detail-modal .salary {
            color: #CA4499;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .job-detail-modal .salary::before {
            content: '\f157';  /* Font Awesome 的 fa-yen-sign 图标 */
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            font-size: 18px;
            color: #CA4499;
        }

        /* 3. 底部区域调整 */
        .job-detail-modal .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            margin-top: 20px;
            border-top: 1px solid #f0f0f0;
            background-color: #fafafa;
        }

        /* 3.1 收藏按钮 */
        .job-detail-modal .modal-footer .favorite-btn {
            position: relative;
            top: 0px;
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
        }

        /* 3.2 投递简历按钮 */
        .job-detail-modal .modal-footer .apply-btn {
            position: relative;
            top: 0px;
            padding: 8px 24px;
            background: #CA4499;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        /* 职位标题区域布局 */
        .job-detail-modal .title-section {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .job-detail-modal .title-section h3 {
            font-size: 22px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        /* 工作类型和学历要求标签样式 */
        .job-detail-modal .job-tags {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .job-detail-modal .job-tag {
            font-size: 13px;
            color: #666;
            background-color: rgba(202, 68, 153, 0.08);
            padding: 2px 8px;
            border-radius: 4px;
            display: flex;
            align-items: center;
        }

        .job-detail-modal .job-tag::before {
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            margin-right: 4px;
            font-size: 12px;
        }

        .job-detail-modal .job-tag.type::before {
            content: '\f0b1';  /* fa-briefcase */
            color: #CA4499;
        }

        .job-detail-modal .job-tag.education::before {
            content: '\f19d';  /* fa-graduation-cap */
            color: #CA4499;
        }

        /* 在 style 标签内添加这些新样式 */
        .job-detail-modal .job-title-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .job-detail-modal .job-meta-tags {
            display: flex;
            gap: 8px;
        }

        .job-detail-modal .job-meta-tag {
            font-size: 13px;
            color: #666;
            background-color: rgba(202, 68, 153, 0.08);
            padding: 2px 8px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .job-detail-modal .job-meta-tag i {
            font-size: 12px;
            color: #CA4499;
        }
    </style>
</head>
<body>
    <div id="header"></div>

    <!-- 修改搜索区域 -->
    <div class="search-section">
        <div class="search-container">
            <input 
                type="text" 
                class="main-search-input search-input" 
                placeholder="搜索职位、公司名称">
            <button type="button" class="search-button" onclick="searchJobs()">搜索</button>
        </div>
        <div class="hot-tags">
            热门搜索：
            <a href="#" class="hot-tag" onclick="searchWithTag(event, 'Java')">Java</a>
            <a href="#" class="hot-tag" onclick="searchWithTag(event, '前端')">前端</a>
            <a href="#" class="hot-tag" onclick="searchWithTag(event, '算法')">算法</a>
            <a href="#" class="hot-tag" onclick="searchWithTag(event, '测试')">测试</a>
        </div>
    </div>

    <div class="main-container">
        <!-- 左侧筛选栏 -->
        <div class="filter-sidebar">
            <h2 class="filter-title">Filter by</h2>
            
            <div class="filter-section">
                <h3>
                    <i class="fas fa-map-marker-alt"></i>
                    工作地点
                </h3>
                <div class="filter-list" data-filter="location"></div>
            </div>

            <div class="filter-section">
                <h3>
                    <i class="fas fa-briefcase"></i>
                    工作类型
                </h3>
                <div class="filter-list" data-filter="jobType"></div>
            </div>

            <div class="filter-section">
                <h3>
                    <i class="fas fa-graduation-cap"></i>
                    学历要求
                </h3>
                <div class="filter-list" data-filter="education"></div>
            </div>
        </div>

        <!-- 中间内容区 -->
        <div class="content-area">
            <div class="toolbar">
                <div class="result-info">
                    <span class="result-count">${totalItems + ' 个职位'}</span>
                </div>
                <div class="sort-buttons">
                    <button class="sort-btn ${currentSort === 'latest' ? 'active' : ''}" 
                            onclick="changeSort('latest')">
                        <i class="fas fa-clock"></i>最新发布
                    </button>
                    <button class="sort-btn ${currentSort === 'salary' ? 'active' : ''}" 
                            onclick="changeSort('salary')">
                        <i class="fas fa-yen-sign"></i>薪资最高
                    </button>
                </div>
            </div>

            <div class="job-list">
                <div class="job-card" th:each="job : ${jobs}" th:attr="data-job-id=${job.id}">
                    <div class="job-header">
                        <h3 class="job-title" th:text="${job.title}">Java开发实习生</h3>
                        <button class="apply-btn">投递简历</button>
                    </div>
                    <div class="job-meta">
                        <span th:text="${job.companyName}">阿里巴巴</span>
                        <span th:text="${job.location}">杭州</span>
                        <span th:text="${job.salary}">300-400/天</span>
                        <span class="upload-time" th:text="'发布于 ' + ${#temporals.format(job.createdAt, 'yyyy年MM月dd日')}">更新于 2024年2月27日</span>
                    </div>
                    <div class="job-tags">
                        <span class="job-tag" th:text="${job.jobType}">全职实习</span>
                        <span class="job-tag" th:text="${job.education}">本科及以上</span>
                    </div>
                    <div class="job-footer">
                        <div class="actions">
                            <button class="favorite-btn">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 修改分页部分 -->
            <div class="pagination" th:if="${totalPages > 0}">
                <a th:if="${currentPage > 0}"
                   th:href="@{/recommend(page=${currentPage - 1}, keyword=${keyword}, location=${location}, jobType=${jobType}, education=${education}, sortBy=${sortBy})}"
                   class="page-btn">上一页</a>
                   
                <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                    <a th:href="@{/recommend(page=${i}, keyword=${keyword}, location=${location}, jobType=${jobType}, education=${education}, sortBy=${sortBy})}"
                       class="page-btn" th:classappend="${currentPage == i} ? 'active' : ''"
                       th:text="${i + 1}">1</a>
                </th:block>
                
                <a th:if="${currentPage < totalPages - 1}"
                   th:href="@{/recommend(page=${currentPage + 1}, keyword=${keyword}, location=${location}, jobType=${jobType}, education=${education}, sortBy=${sortBy})}"
                   class="page-btn">下一页</a>
            </div>
        </div>

        <!-- 右侧推广区 -->
        <div class="promotion-area">
            <div class="promotion-box">
                <img src="/images/tp.jpg" alt="冲啊">
                <h3 class="promotion-title">寻找优质实习机会</h3>
                <p class="promotion-content">
                    在这里发现最新的实习岗位，获取职业发展机会。
                    定制你的求职偏好，让好工作主动找上门。
                </p>
                <a href="#" class="promotion-link">了解更多 →</a>
            </div>

            <div class="promotion-box">
                <img src="/images/xx.jpg" alt="反馈">
                <h3 class="promotion-title">帮助我们改进搜索体验</h3>
                <p class="promotion-content">
                    你的反馈对我们很重要！
                    告诉我们如何让搜索变得更好。
                </p>
                <a href="#" class="promotion-link">提供反馈</a>
            </div>

            <div class="promotion-box">
                <p class="promotion-content">
                    提示：按下 <kbd>/</kbd> 键快速激活搜索框
                </p>
            </div>
        </div>
    </div>

    <div id="footer"></div>

    <!-- 添加反馈提示元素 -->
    <div id="feedbackToast" class="feedback-toast"></div>

    <!-- 添加申请岗位弹窗 -->
    <div class="modal-overlay" id="applyModal" style="display: none;">
        <div class="apply-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>申请岗位</h3>
                <button class="close-btn" onclick="closeApplyModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="job-info">
                    <div class="job-title" id="applyJobTitle"></div>
                    <div class="job-company">
                        <i class="fas fa-building"></i>
                        <span id="applyJobCompany"></span>
                    </div>
                    <div class="job-salary">
                        <i class="fas fa-yen-sign"></i>
                        <span id="applyJobSalary"></span>
                    </div>
                </div>
                
                <div class="confirm-message">
                    <i class="fas fa-info-circle"></i>
                    <span>确认要申请该岗位吗？</span>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="cancel-btn" onclick="closeApplyModal()">取消</button>
                <button class="confirm-btn" id="confirmApplyBtn" onclick="confirmApply()">
                    <i class="fas fa-paper-plane"></i>
                    确认申请
                </button>
            </div>
        </div>
    </div>

    <!-- 添加职位详情弹窗 -->
    <div class="modal-overlay" id="jobDetailModal" style="display: none;">
        <div class="modal-content job-detail-modal">
            <div class="modal-header">
                <h3 id="jobDetailTitle">职位详情</h3>
                <button class="close-btn" onclick="closeJobDetailModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="job-detail-info">
                    <div class="job-header-info">
                        <div class="job-title-wrapper">
                            <h2 id="jobTitle"></h2>
                            <div class="job-meta-tags">
                                <span class="job-meta-tag">
                                    <i class="fas fa-briefcase"></i>
                                    <span id="jobTypeTag"></span>
                                </span>
                                <span class="job-meta-tag">
                                    <i class="fas fa-graduation-cap"></i>
                                    <span id="jobEducationTag"></span>
                                </span>
                            </div>
                        </div>
                        <div class="salary" id="jobSalary"></div>
                    </div>
                    <div class="company-info">
                        <span id="companyName" class="company-name"></span>
                        <span id="jobLocation" class="location"></span>
                    </div>
                    <div class="job-description">
                        <h4>职位描述</h4>
                        <p id="jobDescription">加载中...</p>
                    </div>
                    <div class="job-requirements">
                        <h4>岗位要求</h4>
                        <p id="jobRequirements">加载中...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="favorite-btn" id="detailFavoriteBtn">
                    <i class="far fa-star"></i>
                </button>
                <button class="apply-btn" id="detailApplyBtn">投递简历</button>
            </div>
        </div>
    </div>

<script>
    // 将 initializeFavorites 函数移到全局作用域
    async function initializeFavorites() {
        const studentId = localStorage.getItem('userId');
        if (!studentId) {
            console.log('No student ID found, skipping favorites initialization');
            return;
        }

        const jobCards = document.querySelectorAll('.job-card');
        console.log('Found job cards:', jobCards.length);

        for (const card of jobCards) {
            const jobId = card.getAttribute('data-job-id');
            const favoriteBtn = card.querySelector('.favorite-btn');
            
            if (!jobId || !favoriteBtn) {
                console.log('Skipping card:', { jobId, hasButton: !!favoriteBtn });
                continue;
            }

            try {
                const response = await fetch(
                    `http://localhost:8888/api/job-favorites/check?studentId=${studentId}&jobId=${jobId}`,
                    { credentials: 'include' }
                );

                if (!response.ok) continue;

                const data = await response.json();
                console.log('Favorite status for job:', jobId, data);
                
                const icon = favoriteBtn.querySelector('i');
                if (data.favorite) {
                    icon.className = 'fas fa-star';
                    icon.style.color = '#CA4499';
                }
            } catch (error) {
                console.error('Error checking favorite for job:', jobId, error);
            }
        }
    }

    // 修改 displayJobs 函数，添加收藏状态初始化
    function displayJobs(jobs, container, page) {
        // ... 原有的显示逻辑保持不变 ...
        
        // 在职位卡片渲染完成后初始化收藏状态
        setTimeout(() => {
            initializeFavorites();
        }, 100);
    }

    // 页面加载完成后加载所有职位
    document.addEventListener('DOMContentLoaded', function() {
        // 等待 jQuery 加载完成组件后再加载职位
    $(document).ready(function() {
            loadAllJobs();
            checkLoginStatus(); // 添加登录状态检查
        });
    });

    // 添加全局变量存储所有职位数据
    let allJobs = [];

    // 添加筛选状态管理
    let selectedFilters = {
        location: new Set(),
        jobType: new Set(),
        education: new Set()
    };

    // 添加排序状态
    let currentSort = 'latest'; // 'latest' 或 'salary'

    // 更新筛选项的选中状态和数量
    function updateFilterCounts(jobs) {
        // 重置所有计数
        document.querySelectorAll('.filter-count').forEach(count => {
            count.textContent = '0';
        });

        // 计算新的计数
        jobs.forEach(job => {
            // 更新地点计数
            const locationItem = document.querySelector(`[data-filter-type="location"][data-filter-value="${job.location}"]`);
            if (locationItem) {
                const countElement = locationItem.querySelector('.filter-count');
                if (countElement) {
                    const currentCount = parseInt(countElement.textContent) || 0;
                    countElement.textContent = currentCount + 1;
                }
            }

            // 更新工作类型计数
            const jobTypeItem = document.querySelector(`[data-filter-type="jobType"][data-filter-value="${job.jobType}"]`);
            if (jobTypeItem) {
                const countElement = jobTypeItem.querySelector('.filter-count');
                if (countElement) {
                    const currentCount = parseInt(countElement.textContent) || 0;
                    countElement.textContent = currentCount + 1;
                }
            }

            // 更新学历要求计数
            const educationItem = document.querySelector(`[data-filter-type="education"][data-filter-value="${job.education}"]`);
            if (educationItem) {
                const countElement = educationItem.querySelector('.filter-count');
                if (countElement) {
                    const currentCount = parseInt(countElement.textContent) || 0;
                    countElement.textContent = currentCount + 1;
                }
            }
        });
    }

    // 处理筛选项点击
    function handleFilterClick(event) {
        const item = event.currentTarget;
        const type = item.dataset.filterType;
        const value = item.dataset.filterValue;

        // 切换选中状态
        item.classList.toggle('selected');
        if (selectedFilters[type].has(value)) {
            selectedFilters[type].delete(value);
        } else {
            selectedFilters[type].add(value);
        }

        // 应用筛选
        applyFilters();
    }

    // 应用筛选条件
    function applyFilters() {
        const filteredJobs = allJobs.filter(job => {
            const locationMatch = selectedFilters.location.size === 0 || 
                selectedFilters.location.has(job.location);
            const jobTypeMatch = selectedFilters.jobType.size === 0 || 
                selectedFilters.jobType.has(job.jobType);
            const educationMatch = selectedFilters.education.size === 0 || 
                selectedFilters.education.has(job.education);

            return locationMatch && jobTypeMatch && educationMatch;
        });

        const jobsGrid = document.querySelector('.content-area');
        displayJobs(filteredJobs, jobsGrid, 0);
        // 使用原始的 allJobs 更新计数，而不是筛选后的结果
        updateFilterCounts(allJobs);
    }

    // 修改加载所有职位的函数
    function loadAllJobs() {
        const jobsGrid = document.querySelector('.content-area');
        jobsGrid.innerHTML = '<div class="loading">加载中...</div>';

        fetch('http://localhost:8888/api/latest-jobs')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (!data || !Array.isArray(data)) {
                    throw new Error('Invalid response format');
                }

                if (data.length === 0) {
                    jobsGrid.innerHTML = '<div class="no-jobs">暂无职位信息</div>';
                    return;
                }

                allJobs = data;
                displayJobs(allJobs, jobsGrid, 0);
                
                // 初始化筛选项
                initializeFilters(allJobs);
            })
            .catch(error => {
                console.error('Error loading jobs:', error);
                jobsGrid.innerHTML = `<div class="error">加载失败：${error.message}</div>`;
            });
    }

    // 初始化筛选项
    function initializeFilters(jobs) {
        // 获取所有唯一值
        const filters = {
            location: new Set(jobs.map(job => job.location)),
            jobType: new Set(jobs.map(job => job.jobType)),
            education: new Set(jobs.map(job => job.education))
        };

        // 更新筛选项 UI
        Object.entries(filters).forEach(([type, values]) => {
            const filterList = document.querySelector(`.filter-list[data-filter="${type}"]`);
            if (filterList) {
                filterList.innerHTML = Array.from(values).map(value => `
                    <div class="filter-item" data-filter-type="${type}" data-filter-value="${value}">
                        <span class="filter-label">${value}</span>
                        <span class="filter-count">0</span>
                    </div>
                `).join('');

                // 添加点击事件
                filterList.querySelectorAll('.filter-item').forEach(item => {
                    item.addEventListener('click', handleFilterClick);
                });
            }
        });

        // 更新数量
        updateFilterCounts(jobs);
    }

    // 修改显示职位列表的函数
    function displayJobs(jobs, container, currentPage = 0) {
        // 对职位进行排序
        const sortedJobs = [...jobs].sort((a, b) => {
            if (currentSort === 'latest') {
                return new Date(b.updatedAt) - new Date(a.updatedAt);
            } else if (currentSort === 'salary') {
                // 假设薪资格式为 "300-400/天"
                const getSalaryValue = (salary) => {
                    const matches = salary.match(/(\d+)-(\d+)/);
                    return matches ? parseInt(matches[2]) : 0; // 使用最高薪资
                };
                return getSalaryValue(b.salary) - getSalaryValue(a.salary);
            }
            return 0;
        });

        const itemsPerPage = 9;
        const totalPages = Math.ceil(sortedJobs.length / itemsPerPage);
        
        const startIndex = currentPage * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const currentJobs = sortedJobs.slice(startIndex, endIndex);

        container.innerHTML = `
            <div class="toolbar">
                <div class="result-info">
                    <span class="result-count">${jobs.length} 个职位</span>
                </div>
                <div class="sort-buttons">
                    <button class="sort-btn ${currentSort === 'latest' ? 'active' : ''}" 
                            onclick="changeSort('latest')">
                        <i class="fas fa-clock"></i>最新发布
                    </button>
                    <button class="sort-btn ${currentSort === 'salary' ? 'active' : ''}" 
                            onclick="changeSort('salary')">
                        <i class="fas fa-yen-sign"></i>薪资最高
                    </button>
                </div>
            </div>
            <div class="job-list">
                ${currentJobs.map(job => `
                    <div class="job-card" data-job-id="${job.id}">
                        <div class="job-header">
                            <h3 class="job-title">${job.title || '职位未知'}</h3>
                            <button class="apply-btn">投递简历</button>
                        </div>
                        <div class="job-info">
                            <span class="company-name">${job.companyName || '公司未知'}</span>
                            <span class="location">${job.location || '地点未知'}</span>
                            <span class="salary">${job.salary || '300-400/天'}</span>
                            <span class="update-time">发布于 ${formatDate(job.updatedAt || new Date())}</span>
                        </div>
                        <div class="job-tags">
                            <span class="tag">${job.jobType || '全职实习'}</span>
                            <span class="tag">${job.education || '本科及以上'}</span>
                        </div>
                        <div class="job-footer">
                            <div class="actions">
                                <button class="favorite-btn">
                                    <i class="far fa-star"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
            ${totalPages > 1 ? `
                <div class="pagination">
                    ${Array(totalPages).fill(0).map((_, i) => `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                                onclick="changePage(${i})">${i + 1}</button>
                    `).join('')}
                </div>
            ` : ''}
        `;

        // 在职位卡片渲染完成后初始化收藏状态
        setTimeout(() => {
            initializeFavorites();
        }, 100);
    }

    // 修改分页切换函数
    function changePage(page) {
        const jobsGrid = document.querySelector('.content-area');
        displayJobs(allJobs, jobsGrid, page);
    }

    // 修改搜索函数
    function searchJobs() {
        const jobsGrid = document.querySelector('.content-area');
        const keyword = document.querySelector('.search-input').value;
        const location = document.querySelector('[name="location"]')?.value;
        const jobType = document.querySelector('[name="jobType"]')?.value;
        const education = document.querySelector('[name="education"]')?.value;

        if (!keyword && (!location || location === '全部') && (!jobType || jobType === '全部') && (!education || education === '全部')) {
            loadAllJobs();
            return;
        }

        jobsGrid.innerHTML = '<div class="loading">搜索中...</div>';

        const params = new URLSearchParams();
        if (keyword) params.append('keyword', keyword);
        if (location && location !== '全部') params.append('location', location);
        if (jobType && jobType !== '全部') params.append('jobType', jobType);
        if (education && education !== '全部') params.append('education', education);

        fetch(`http://localhost:8888/api/jobs/search?${params.toString()}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (!data || !Array.isArray(data)) {
                    throw new Error('Invalid response format');
                }

                if (data.length === 0) {
                    jobsGrid.innerHTML = '<div class="no-jobs">未找到匹配的职位</div>';
                    // 清空筛选项计数
                    updateFilterCounts([]);
                    return;
                }

                // 保存搜索结果到全局变量
                allJobs = data;
                // 显示第一页
                displayJobs(allJobs, jobsGrid, 0);
                // 更新筛选项计数
                updateFilterCounts(allJobs);
                // 重新初始化筛选选项
                initializeFilters(allJobs);
            })
            .catch(error => {
                console.error('Error searching jobs:', error);
                jobsGrid.innerHTML = `<div class="error">搜索失败：${error.message}</div>`;
            });
    }

    // 添加标签点击搜索功能
    function searchWithTag(event, keyword) {
        event.preventDefault();
        document.querySelector('.search-input').value = keyword;
        searchJobs();
    }

    // 添加日期格式化函数
    function formatDate(date) {
        const d = new Date(date);
        const year = d.getFullYear();
        const month = (d.getMonth() + 1).toString().padStart(2, '0');
        const day = d.getDate().toString().padStart(2, '0');
        return `${year}年${month}月${day}日`;
    }

    // 为搜索输入框添加回车事件
    document.querySelector('.search-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            searchJobs();
        }
    });

    // 添加排序切换函数
    function changeSort(sortType) {
        currentSort = sortType;
        const jobsGrid = document.querySelector('.content-area');
        displayJobs(allJobs, jobsGrid, 0); // 切换排序时回到第一页
    }

    // 添加登录状态检查函数
    function checkLoginStatus() {
        const userStr = localStorage.getItem('user');
        if (userStr) {
            const user = JSON.parse(userStr);
            const userAvatar = document.querySelector('#userAvatar');
            const userName = document.querySelector('#userName');
            if (userAvatar && userName) {
                userAvatar.src = user.image || '/images/default-avatar.png';
                userName.textContent = user.name;
                
                // 更新用户容器的点击事件
                const userContainer = document.querySelector('#userContainer');
                if (userContainer) {
                    userContainer.removeEventListener('click', redirectToLogin);
                    userContainer.addEventListener('click', toggleDropdown);
                }
            }
        }
    }

    // 添加切换下拉菜单的函数
    function toggleDropdown(e) {
        e.stopPropagation();
        const dropdownMenu = document.querySelector('#dropdownMenu');
        if (dropdownMenu) {
            dropdownMenu.classList.toggle('show');
        }
    }

    // 添加点击其他地方关闭下拉菜单
    document.addEventListener('click', () => {
        const dropdownMenu = document.querySelector('#dropdownMenu');
        if (dropdownMenu) {
            dropdownMenu.classList.remove('show');
        }
    });

    // 添加登出功能
    document.addEventListener('DOMContentLoaded', () => {
        const logoutBtn = document.querySelector('#logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('user');
                window.location.href = '/login.html';
            });
        }
    });

    // 添加重定向到登录页面的函数
    function redirectToLogin() {
        window.location.href = '/login.html';
    }

    $(document).ready(function() {
        $("#header").load("/components/header.html", function() {
            // header 加载完成后初始化
            if (window.initializeHeader) {
                window.initializeHeader();
            }
        });
        $("#footer").load("/components/footer.html");
    });

    // 完全阻止job-card的默认点击行为
    document.addEventListener('DOMContentLoaded', function() {
        // 阻止所有job-card的点击事件，包括动态生成的
        function preventCardClicks() {
            document.querySelectorAll('.job-card').forEach(card => {
                // 移除可能存在的旧事件监听器
                card.removeEventListener('click', preventClick);
                // 添加新的事件监听器
                card.addEventListener('click', preventClick);
            });
        }

        function preventClick(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }

        // 初始阻止点击
        preventCardClicks();

        // 在加载新数据后也要阻止点击
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.addedNodes.length) {
                    preventCardClicks();
                }
            });
        });

        // 观察job-list的变化
        const jobList = document.querySelector('.job-list');
        if (jobList) {
            observer.observe(jobList, { childList: true, subtree: true });
        }

        // 获取所有职位卡片
        const jobCards = document.querySelectorAll('.job-card');
        
        // 为每个职位卡片添加data-job-id
        jobCards.forEach(card => {
            // 从现有的onclick属性中提取ID
            const onclick = card.getAttribute('onclick');
            if (onclick) {
                const match = onclick.match(/id=(\d+)/);
                if (match) {
                    card.setAttribute('data-job-id', match[1]);
                }
            }
        });

        // 添加调试日志
        function logJobCardInfo(card) {
            console.log('Job Card:', {
                element: card,
                jobId: card.getAttribute('data-job-id'),
                hasButton: !!card.querySelector('.favorite-btn'),
                html: card.outerHTML
            });
        }

        // 获取当前登录用户ID
        function getCurrentUserId() {
            // 从 localStorage 获取学生ID
            const studentId = localStorage.getItem('userId');
            if (!studentId) {
                console.warn('No student ID found in localStorage');
                return null;
            }
            return parseInt(studentId);
        }

        // 收藏按钮点击处理
        document.addEventListener('click', async function(e) {
            const favoriteBtn = e.target.closest('.favorite-btn');
            if (!favoriteBtn) return;

            e.preventDefault();
            e.stopPropagation();

            const jobCard = favoriteBtn.closest('.job-card');
            const jobId = jobCard.dataset.jobId;
            const studentId = getCurrentUserId();

            if (!studentId) {
                showFeedback('请先登录', false);
                return;
            }

            if (!jobId) {
                showFeedback('无法获取职位ID', false);
                return;
            }

            if (favoriteBtn.classList.contains('loading')) return;
            favoriteBtn.classList.add('loading');

            try {
                const response = await fetch('http://localhost:8888/api/job-favorites/toggle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        studentId: studentId,
                        jobId: parseInt(jobId)
                    }),
                    credentials: 'include'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const icon = favoriteBtn.querySelector('i');

                if (data.favorite) {
                    icon.className = 'fas fa-star';
                    icon.style.color = '#CA4499';    // 设置系统色
                    showFeedback('收藏成功');
                } else {
                    icon.className = 'far fa-star';
                    icon.style.color = '#999';       // 设置默认颜色
                    showFeedback('已取消收藏');
                }
            } catch (error) {
                console.error('Error:', error);
                showFeedback('操作失败，请重试', false);
            } finally {
                favoriteBtn.classList.remove('loading');
            }
        });

        // 修改职位加载完成后的处理
        const originalLoadJobs = window.loadJobs;
        window.loadJobs = async function(jobs) {
            await originalLoadJobs(jobs);
            await initializeFavorites();
        };

        // 页面加载完成后执行
        initializeFavorites();
    });

    // 工具函数：显示反馈提示
    function showFeedback(message, isSuccess = true) {
        const toast = document.getElementById('feedbackToast');
        toast.textContent = message;
        toast.style.backgroundColor = isSuccess ? 'rgba(0, 0, 0, 0.8)' : 'rgba(255, 0, 0, 0.8)';
        toast.style.display = 'block';
        setTimeout(() => {
            toast.style.display = 'none';
        }, 2000);
    }

    // 全局变量存储当前选中的岗位信息
    let selectedJob = null;

    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', function() {
        // 设置投递简历按钮事件
        setupApplyButtons();
        
        // 设置岗位卡点击事件
        setupJobCardClickEvents();
        
        // 监听DOM变化，以便处理动态加载的内容
        const observer = new MutationObserver(function(mutations) {
            console.log("检测到DOM变化，重新设置按钮事件");
            setupApplyButtons();
            setupJobCardClickEvents();
        });
        
        // 监听整个文档的变化
        observer.observe(document.body, { childList: true, subtree: true });
    });

    // 设置岗位卡点击事件
    function setupJobCardClickEvents() {
        console.log("设置岗位卡点击事件");
        const jobCards = document.querySelectorAll('.job-card');
        
        jobCards.forEach(card => {
            card.addEventListener('click', function(event) {
                // 如果点击的是按钮，不触发卡片的点击事件
                if (event.target.tagName === 'BUTTON' || 
                    event.target.closest('button') || 
                    event.target.tagName === 'I' || 
                    event.target.closest('i')) {
                    console.log("点击了按钮，不触发卡片点击");
                    return;
                }
                
                console.log("岗位卡被点击");
                const jobId = this.getAttribute('data-job-id');
                const jobTitle = this.querySelector('.job-title').textContent;
                const companyName = this.querySelector('.company-name').textContent;
                const salary = this.querySelector('.salary').textContent;
                const location = this.querySelector('.location').textContent;
                
                console.log("岗位信息:", {id: jobId, title: jobTitle, company: companyName});
                
                // 存储当前选中的岗位信息到全局变量
                window.selectedJob = {
                    id: jobId,
                    title: jobTitle,
                    company: companyName,
                    salary: salary
                };
                
                // 创建一个基本岗位对象
                const jobData = {
                    id: jobId,
                    title: jobTitle,
                    companyName: companyName,
                    salary: salary,
                    location: location,
                    jobType: "全职",
                    education: "本科",
                    description: "加载中...",
                    requirements: "加载中..."
                };
                
                // 打开详情弹窗
                openJobDetailModal(jobData);
                
                // 从后端获取详细信息
                fetch(`http://localhost:8888/api/jobs/${jobId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('获取岗位详情失败');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 更新详情弹窗中的信息
                        document.getElementById('jobDescription').textContent = data.description || "暂无描述";
                        document.getElementById('jobRequirements').textContent = data.requirements || "暂无要求";
                        
                        // 更新其他可能从后端获取的信息
                        if (data.jobType) {
                            document.getElementById('jobTypeTag').textContent = data.jobType;
                        }
                        if (data.education) {
                            document.getElementById('jobEducationTag').textContent = data.education;
                        }
                    })
                    .catch(error => {
                        console.error('获取岗位详情出错:', error);
                        // 使用模拟数据替代
                        document.getElementById('jobDescription').textContent = 
                            "这是一个" + jobTitle + "职位，由" + companyName + "提供。我们正在寻找有才华、有激情的专业人士加入我们的团队。该职位提供具有竞争力的薪资和福利，以及职业发展机会。";
                        document.getElementById('jobRequirements').textContent = 
                            "1. 本科及以上学历\n2. 相关专业背景\n3. 良好的沟通和团队协作能力\n4. 熟练掌握相关技术和工具\n5. 有相关项目经验者优先";
                    });
            });
        });
    }

    // 打开岗位详情弹窗
    function openJobDetailModal(job) {
        // 确保设置全局职位信息
        window.selectedJob = {
            id: job.id,
            title: job.title,
            company: job.companyName,
            salary: job.salary
        };
        
        console.log("打开岗位详情弹窗:", job);
        
        // 填充弹窗内容
        document.getElementById('jobTitle').textContent = job.title;
        document.getElementById('jobSalary').textContent = job.salary;
        document.getElementById('companyName').textContent = job.companyName;
        document.getElementById('jobLocation').textContent = job.location;
        document.getElementById('jobTypeTag').textContent = job.jobType;
        document.getElementById('jobEducationTag').textContent = job.education;
        document.getElementById('jobDescription').textContent = job.description;
        document.getElementById('jobRequirements').textContent = job.requirements;
        
        // 显示弹窗
        document.getElementById('jobDetailModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // 设置投递简历按钮点击事件
        document.getElementById('detailApplyBtn').onclick = function() {
            closeJobDetailModal();
            openApplyModal();
        };
        
        // 设置收藏按钮的状态和点击事件
        const detailFavoriteBtn = document.getElementById('detailFavoriteBtn');
        const studentId = localStorage.getItem('userId');
        
        if (detailFavoriteBtn && job.id) {
            // 首先检查当前职位是否已收藏
            const studentId = localStorage.getItem('userId');
            
            // 修改为正确的 API 路径
            fetch(`http://localhost:8888/api/job-favorites/check?studentId=${studentId}&jobId=${job.id}`)
                .then(response => response.json())
                .then(data => {
                    detailFavoriteBtn.innerHTML = data.favorite ? 
                        '<i class="fas fa-star"></i>' : 
                        '<i class="far fa-star"></i>';
                });

            // 设置点击事件
            detailFavoriteBtn.onclick = async function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                if (!studentId) {
                    showMessage("请先登录后再收藏", "error");
                    return;
                }

                try {
                    // 修改为正确的 API 路径
                    const response = await fetch('http://localhost:8888/api/job-favorites/toggle', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            studentId: parseInt(studentId),
                            jobId: parseInt(job.id)
                        })
                    });

                    const data = await response.json();
                    if (data.favorite !== undefined) {  // 检查返回的 favorite 字段
                        const newIcon = data.favorite ? 
                            '<i class="fas fa-star"></i>' : 
                            '<i class="far fa-star"></i>';
                        
                        detailFavoriteBtn.innerHTML = newIcon;
                        
                        // 同步更新职位卡片中的收藏按钮
                        const jobCard = document.querySelector(`.job-card[data-job-id="${job.id}"]`);
                        if (jobCard) {
                            const cardFavoriteBtn = jobCard.querySelector('.favorite-btn');
                            if (cardFavoriteBtn) {
                                cardFavoriteBtn.innerHTML = newIcon;
                            }
                        }
                        
                        showMessage(data.favorite ? "收藏成功" : "取消收藏成功", "success");
                    } else {
                        showMessage("操作失败", "error");
                    }
                } catch (error) {
                    console.error('收藏操作失败:', error);
                    showMessage("操作失败，请稍后再试", "error");
                }
            };
        }
    }

    // 关闭岗位详情弹窗
    function closeJobDetailModal() {
        document.getElementById('jobDetailModal').style.display = 'none';
        document.body.style.overflow = '';
    }

    // 修改 setupApplyButtons 函数
    function setupApplyButtons() {
        console.log("设置申请按钮事件");
        // 获取所有投递简历按钮
        const applyButtons = document.querySelectorAll('.apply-btn');
        
        // 为每个按钮添加点击事件
        applyButtons.forEach(button => {
            console.log("找到投递简历按钮");
            button.addEventListener('click', function(event) {
                event.stopPropagation(); // 阻止事件冒泡
                
                // 检查是否是详情弹窗中的按钮
                if (this.id === 'detailApplyBtn') {
                    // 使用已存储的职位信息
                    if (window.selectedJob) {
                        openApplyModal();
                    } else {
                        console.error("找不到职位信息");
                        showMessage("无法获取职位信息", "error");
                    }
                    return;
                }
                
                // 职位卡片中的按钮逻辑
                const jobCard = this.closest('.job-card');
                if (!jobCard) {
                    console.error("找不到岗位元素");
                    return;
                }
                
                const jobId = jobCard.getAttribute('data-job-id');
                const jobTitle = jobCard.querySelector('.job-title')?.textContent || "未知岗位";
                const companyName = jobCard.querySelector('.company-name')?.textContent || "未知公司";
                const salary = jobCard.querySelector('.salary')?.textContent || "薪资面议";
                
                console.log("岗位信息:", { id: jobId, title: jobTitle, company: companyName, salary: salary });
                
                // 存储当前选中的岗位信息到全局变量
                window.selectedJob = {
                    id: jobId,
                    title: jobTitle,
                    company: companyName,
                    salary: salary
                };
                
                openApplyModal();
            });
        });
        
        // 点击弹窗背景关闭弹窗
        const modal = document.getElementById('applyModal');
        if (modal) {
            modal.addEventListener('click', function(event) {
                if (event.target === this) {
                    closeApplyModal();
                }
            });
        }
    }

    function openApplyModal() {
        console.log("打开申请弹窗，岗位信息:", window.selectedJob);
        
        if (!window.selectedJob) {
            console.error("没有选中的岗位信息");
            return;
        }
        
        // 填充申请弹窗内容
        document.getElementById('applyJobTitle').textContent = window.selectedJob.title;
        document.getElementById('applyJobCompany').textContent = window.selectedJob.company;
        document.getElementById('applyJobSalary').textContent = window.selectedJob.salary;
        
        // 显示弹窗
        document.getElementById('applyModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    // 关闭申请弹窗
    function closeApplyModal() {
        console.log("关闭申请弹窗");
        const modal = document.getElementById('applyModal');
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = ''; // 恢复背景滚动
        }
    }

    // 修改确认申请函数
    async function confirmApply() {
        console.log("确认申请", window.selectedJob);
        
        if (!window.selectedJob || !window.selectedJob.id) {
            showMessage("无法获取岗位信息，请刷新页面重试", "error");
            return;
        }

        const studentId = localStorage.getItem('userId');
        if (!studentId) {
            showMessage("请先登录后再申请", "error");
            closeApplyModal();
            return;
        }

        try {
            const response = await fetch('http://localhost:8888/api/applications', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    studentId: parseInt(studentId),
                    jobId: parseInt(window.selectedJob.id)
                })
            });

            // 获取响应数据
            const data = await response.json();
            console.log('申请响应:', {
                status: response.status,
                data: data
            });

            // 处理不同的响应情况
            if (response.status === 400) {
                // 400 状态码通常表示业务逻辑错误，如已申请过
                showMessage(data.message || "您已经申请过该岗位", "error");
                closeApplyModal();
            } else if (response.status === 200 && data.success) {
                // 申请成功
                showMessage("申请成功！", "success");
                closeApplyModal();
            } else {
                // 其他错误情况
                throw new Error(data.message || "申请失败，请稍后再试");
            }
        } catch (error) {
            console.error('申请出错:', error);
            showMessage(error.message || "申请失败，请稍后再试", "error");
        }
    }

    // 修改消息提示函数，使其更明显
    function showMessage(message, type = 'info') {
        const messageToast = document.createElement('div');
        messageToast.className = `message-toast ${type}`;
        messageToast.textContent = message;
        
        // 移除可能存在的旧消息
        const oldToast = document.querySelector('.message-toast');
        if (oldToast) {
            oldToast.remove();
        }
        
        document.body.appendChild(messageToast);
        
        // 显示动画
        setTimeout(() => {
            messageToast.classList.add('show');
        }, 10);
        
        // 3秒后自动关闭
        setTimeout(() => {
            messageToast.classList.remove('show');
            setTimeout(() => {
                if (messageToast.parentNode) {
                    messageToast.parentNode.removeChild(messageToast);
                }
            }, 300);
        }, 3000);
    }
</script>
</body>
</html> 